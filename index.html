<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£o Paulo - Produ√ß√£o</title>
    <style>
        :root { --cor-arte: #9b59b6; --cor-espera: #f1c40f; --cor-producao: #e67e22; --cor-preparando: #3498db; --cor-enviado: #2ecc71; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 10px; margin: 0; }
        .container { max-width: 500px; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .form-box { background: #eef2f7; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
        .card { padding: 15px; margin-top: 15px; border-radius: 8px; border-left: 10px solid #ccc; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .status-arte { border-left-color: var(--cor-arte); }
        .status-espera { border-left-color: var(--cor-espera); }
        .status-producao { border-left-color: var(--cor-producao); }
        .status-preparando { border-left-color: var(--cor-preparando); }
        .status-enviado { border-left-color: var(--cor-enviado); }
        .btn-proximo { width: 100%; padding: 12px; background: #333; color: white; border: none; border-radius: 6px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-del { position: absolute; top: 10px; right: 10px; border: none; background: none; color: #ccc; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="titulo" style="text-align: center;">Gest√£o de Pedidos</h2>

    <div id="area-cadastro" class="form-box">
        <label>üë§ CLIENTE:</label> <input type="text" id="cli">
        <label>üëï PRODUTO:</label> <input type="text" id="prod">
        <label>üé® DETALHES:</label> <input type="text" id="cor_est">
        <label>üìÖ ENVIO:</label> <input type="datetime-local" id="data">
        <label>üí∞ FINANCEIRO:</label>
        <select id="pag">
            <option value="PENDENTE">Pendente</option>
            <option value="METADE">50% Pago</option>
            <option value="TOTAL">Total Pago</option>
        </select>
        <button onclick="cadastrar()" id="btn-cad" style="width:100%; background: #1a73e8; color: white; padding: 15px; border: none; border-radius: 8px; margin-top: 15px; font-weight: bold; cursor: pointer;">LAN√áAR NO SISTEMA</button>
    </div>

    <div id="lista">Sincronizando...</div>
</div>

<script>
    // ‚ö†Ô∏è COLE SEU NOVO LINK AQUI
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxptJfRSBxTmxJHyxFulO2zYWnrLAaZxd-U00VKITcp21rYTuExf7KYSOM05AR8qHoaBA/exec"; 
    
    const FLUXO = ["Criar arte", "Esperando aprova√ß√£o", "Mesa de produ√ß√£o", "Preparando", "Enviado"];

    async function listar() {
        const listaDiv = document.getElementById('lista');
        try {
            const res = await fetch(SCRIPT_URL);
            const rawData = await res.json();
            
            if (!rawData || rawData.length === 0) {
                listaDiv.innerHTML = "Nenhum pedido na fila.";
                return;
            }

            listaDiv.innerHTML = '';
            rawData.forEach(p => {
                const status = p.status || "Criar arte";
                const idx = FLUXO.indexOf(status);
                const proximo = FLUXO[idx + 1];

                const div = document.createElement('div');
                div.className = `card status-${status.toLowerCase().split(' ')[0]}`; // Simplificado
                div.innerHTML = `
                    <button class="btn-del" onclick="deletar('${p.id}')">√ó</button>
                    <div style="font-size: 0.7rem; font-weight: bold; color: #888;">${status.toUpperCase()}</div>
                    <div style="font-weight: bold; font-size: 1.1rem;">${p.cliente || 'Sem Nome'}</div>
                    <div style="font-size: 0.9rem; color: #444;">${p.produto} | ${p.cor}</div>
                    <div style="color: red; font-size: 0.8rem; font-weight: bold;">‚è∞ ${p.dataenvio}</div>
                    ${proximo ? `<button class="btn-proximo" onclick="mudarStatus('${p.id}', '${proximo}')">AVAN√áAR PARA ${proximo.toUpperCase()}</button>` : '‚úÖ FINALIZADO'}
                `;
                listaDiv.appendChild(div);
            });
        } catch (e) {
            listaDiv.innerHTML = "Erro ao carregar dados.";
        }
    }

    async function cadastrar() {
        const cli = document.getElementById('cli').value;
        const btn = document.getElementById('btn-cad');
        if(!cli) return alert("Nome do cliente obrigat√≥rio!");

        btn.disabled = true;
        btn.innerText = "LAN√áANDO...";

        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: "add",
                    id: String(Date.now()),
                    cliente: cli,
                    produto: document.getElementById('prod').value,
                    cor: document.getElementById('cor_est').value,
                    dataEnvio: document.getElementById('data').value,
                    status: "Criar arte",
                    quitado: document.getElementById('pag').value
                })
            });
            location.reload();
        } catch(e) {
            alert("Erro ao salvar.");
            btn.disabled = false;
        }
    }

    async function mudarStatus(id, novo) {
        await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "updateStatus", id: id, newStatus: novo }) });
        listar();
    }

    async function deletar(id) {
        if(confirm("Excluir?")) {
            await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "delete", id: id }) });
            listar();
        }
    }

    listar();
</script>
</body>
</html>
