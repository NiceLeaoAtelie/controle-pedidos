<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Paulo - Gest√£o de Pedidos</title>
    <style>
        :root {
            --cor-arte: #9b59b6; --cor-espera: #f1c40f; --cor-producao: #e67e22;
            --cor-preparando: #3498db; --cor-enviado: #2ecc71;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; padding: 10px; margin: 0; }
        .container { max-width: 500px; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 20px; }
        .form-box { background: #eef2f7; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #d1d9e6; }
        label { font-weight: bold; font-size: 12px; color: #555; display: block; margin-top: 8px; }
        input, select { width: 100%; padding: 10px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        .card { padding: 15px; margin-top: 15px; border-radius: 8px; border-left: 10px solid #ccc; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .status-arte { border-left-color: var(--cor-arte); }
        .status-espera { border-left-color: var(--cor-espera); }
        .status-producao { border-left-color: var(--cor-producao); }
        .status-preparando { border-left-color: var(--cor-preparando); }
        .status-enviado { border-left-color: var(--cor-enviado); background: #f0fff4; }
        .cliente { font-weight: bold; font-size: 1.2rem; color: #2c3e50; }
        .detalhes { font-size: 0.95rem; color: #444; margin: 8px 0; padding: 8px; background: #f9f9f9; border-radius: 4px; line-height: 1.4; }
        .tag-status { display: inline-block; padding: 3px 10px; font-size: 11px; border-radius: 20px; background: #333; color: white; font-weight: bold; margin-bottom: 5px; }
        .btn-proximo { width: 100%; padding: 12px; background: #333; color: white; border: none; border-radius: 6px; font-weight: bold; margin-top: 10px; cursor: pointer; font-size: 14px; }
        .btn-del { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #bbb; cursor: pointer; font-weight: bold; font-size: 18px; }
        .urgente { color: #d93025; font-weight: bold; font-size: 0.9rem; border: 1px solid #d93025; padding: 2px 5px; border-radius: 4px; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="titulo">Gest√£o de Pedidos</h2>

    <div id="area-cadastro" class="form-box">
        <label>üë§ CLIENTE:</label>
        <input type="text" id="cli" placeholder="Nome do cliente">
        <label>üëï PRODUTO:</label>
        <input type="text" id="prod" placeholder="Ex: Camiseta G">
        <label>üé® COR E ESTAMPA:</label>
        <input type="text" id="cor_est" placeholder="Ex: Azul / Logo Peito">
        <label>üìÖ DATA DE ENVIO:</label>
        <input type="datetime-local" id="data">
        <label>üí∞ PAGAMENTO:</label>
        <select id="pag">
            <option value="PENDENTE">Pendente</option>
            <option value="METADE">50% Pago</option>
            <option value="TOTAL">Total Pago</option>
        </select>
        <button onclick="cadastrar()" id="btn-cad" style="background: #1a73e8; color: white; width:100%; margin-top: 15px; font-weight: bold; border: none; cursor: pointer; padding: 15px; border-radius: 8px;">LAN√áAR NO SISTEMA</button>
    </div>

    <div id="lista">Sincronizando com a planilha...</div>
</div>

<script>
    // ‚ö†Ô∏è ATEN√á√ÉO: Verifique se este link termina em /exec
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxptJfRSBxTmxJHyxFulO2zYWnrLAaZxd-U00VKITcp21rYTuExf7KYSOM05AR8qHoaBA/exec"; 
    
    const params = new URLSearchParams(window.location.search);
    const eProducao = params.has('producao');
    const FLUXO = ["Criar arte", "Esperando aprova√ß√£o", "Mesa de produ√ß√£o", "Preparando", "Enviado"];

    if(eProducao) {
        document.getElementById('area-cadastro').style.display = 'none';
        document.getElementById('titulo').innerText = "Fila da Produ√ß√£o üõ†Ô∏è";
    }

    async function listar() {
        const listaDiv = document.getElementById('lista');
        try {
            console.log("Tentando conectar ao Google...");
            const res = await fetch(SCRIPT_URL);
            
            if (!res.ok) throw new Error("Erro na rede: " + res.status);
            
            const dataRaw = await res.json();
            console.log("Dados recebidos:", dataRaw);

            if (!dataRaw || dataRaw.length === 0) {
                listaDiv.innerHTML = "Nenhum pedido na fila.";
                return;
            }

            // Normaliza para evitar erros de mai√∫sculo/min√∫sculo
            let data = dataRaw.map(item => {
                let n = {};
                for (let k in item) { n[k.toLowerCase().trim()] = item[k]; }
                return n;
            });

            listaDiv.innerHTML = '';
            data.forEach(p => {
                if (eProducao && p.status == "Enviado") return;

                const div = document.createElement('div');
                div.className = `card status-arte`; // Simplifiquei a classe para testar
                
                div.innerHTML = `
                    <button class="btn-del" onclick="deletar('${p.id}')">√ó</button>
                    <div class="cliente">${p.cliente || 'Sem Nome'}</div>
                    <div class="detalhes">
                        <strong>Produto:</strong> ${p.produto || '-'}<br>
                        <strong>Status:</strong> ${p.status || '-'}
                    </div>
                    <button class="btn-proximo" onclick="mudarStatus('${p.id}', 'Mesa de produ√ß√£o')">AVAN√áAR ‚ûî</button>
                `;
                listaDiv.appendChild(div);
            });
        } catch (e) { 
            console.error(e);
            listaDiv.innerHTML = "ERRO DE CONEX√ÉO: " + e.message; 
        }
    }
           
            });
        } catch (e) { 
            console.error("Erro ao listar:", e);
            listaDiv.innerHTML = "‚ö†Ô∏è Erro ao carregar dados. Verifique a aba 'Pedidos' e as permiss√µes do Script."; 
        }
    }

    async function cadastrar() {
        const cli = document.getElementById('cli').value;
        const prod = document.getElementById('prod').value;
        const cor = document.getElementById('cor_est').value;
        const dat =
